/**
 * WYSIWYG Post & See Editor v1.0
 *
 * @author augustine
 *
 * Date: 2014/01/22
 */
(function(a){var n,r;function u(c,b){if(0==a("#PSEditor").length){var d="";0<a('script[src$="jquery.pseditor.min.js"]:first').length?d=a('script[src$="jquery.pseditor.min.js"]:first').attr("src").replace("jquery.pseditor.min.js","pseditor.html"):0<a('script[src$="jquery.pseditor.js"]:first').length&&(d=a('script[src$="jquery.pseditor.js"]:first').attr("src").replace("jquery.pseditor.js","pseditor.html"));a.when(a.get(d),a.get(b)).then(function(b,d){var f=b[0],g=JSON.parse(d[0]),v=0,h=[],k;for(k in g)h[v++]= g[k];for(g=0;g<h[0].length;g++)h[0][g]=String.format('<div><img src="{0}" data-src="{1}" /></div>',h[0][g],h[1][g]),h[1][g]=String.format('<div><img src="{0}" /></div>',h[1][g]);n=h[0].join("");r=h[1].join("");a("body").append(f);t(c)})}else t(c)}function t(c){w(c);x(c);y(c);z(c);A(c);a("#PSEditor .ps_cnl").click(k);B()}function m(c,b,d){var e=(a(window).height()-d)/2+a(window).scrollTop(),l=(a(window).width()-b)/2+a(window).scrollLeft();0>e&&(e=a(window).scrollTop());c.css({width:b,"max-height":d, top:e+"px",left:l+"px"});c.show();a("#PSEditor_mask").fadeTo(250,0.4)}function k(){a("#PSEditor textarea").val("");a("body").css("overflow","auto");a("#PSEditor .ps_dialog").hide();a("#PSEditor #PSEditor_mask").hide();a("#PSEditor .ps_divGallery").css("left",0);p=0}function B(){a("#PSEditor .ps_content .ps_picL").click(function(){var c=a(this).parent(".ps_content").find(".ps_divGallery");c.find(".ps_gallery");0!=p&&(p--,c.animate({left:"+=74"},"200"))});a("#PSEditor .ps_content .ps_picR").click(function(){var c= a(this).parent(".ps_content").find(".ps_divGallery"),b=c.find(".ps_gallery").length-6;0>=b||p==b||(p++,c.animate({left:"-=74"},"200"))})}function w(c){var b=a("#PSEditor .textEditor");b.find(".ps_divGallery").append(a(r).addClass("ps_gallery"));var f={width:428,height:297,controls:"bold italic underline | bullets | color | link | pastetext"};a.extend(!0,f,q);var e=b.find("textarea").cleditor(f);b.find(".ps_ok").click(function(){d.html(e.getHtml());k()});a(c).delegate('[data-type="Text"]',"click", function(){d=a(this);b.find(".ps_content").hide();e.updateHtml(d.html());m(b,500,497)});a(c).delegate('[data-type="TextImage"]',"click",function(){d=a(this);b.find(".ps_content").show();e.updateHtml(d.html());m(b,500,497)})}function x(c){var b=a("#PSEditor .imgSelector");b.find(".ps_album").append(a(n).find("img").addClass("albumimg ps_size80"));b.find(".ps_album img").click(function(){b.find(".ps_album img.blueborder").removeClass("blueborder");a(this).addClass("blueborder")});b.find(".ps_ok").click(function(){var a= b.find(".ps_album img.blueborder").data("src");d.find("img:first").attr("src",a);k()});a(c).delegate('[data-type="Image"]',"click",function(){d=a(this);var c=d.find("img:first").attr("src");b.find(".ps_album img.blueborder").removeClass("blueborder");b.find('.ps_album img[data-src="'+c+'"]').addClass("blueborder");m(b,476,441)})}function C(a){return(a=a.match(/^.*(youtu.be\/|v\/|e\/|u\/\w+\/|embed\/|v=)([^#\&\?]*).*/))?a[2]:""}function y(c){var b=a("#PSEditor .movieEditor");b.find(".ps_ok").click(function(){d.find("img").remove(); d.find("iframe").remove();d.prepend(String.format('<iframe width="640" height="360" src="http://www.youtube.com/embed/{0}" frameborder="0" data-id="{0}" allowfullscreen="0"></iframe>',C(b.find("textarea").val())));k()});b.find("textarea").click(function(){this.select()});a(c).delegate('[data-type="Movie"]',"click",function(){d=a(this);0<d.find("iframe").length&&b.find("textarea").val(d.find("iframe").attr("src"));m(b,500,497)})}function z(c){var b=a("#PSEditor .switchEditor");b.find(".ps_divGallery").append(a(n).addClass("ps_gallery ps_drag")); var f={width:315,height:90,controls:"outerlink"},e={width:315,height:90,controls:"bold italic underline | bullets | color | link | pastetext"};a.extend(!0,f,q);var l=b.find(".switchArea1").cleditor(f);l[0].$frame.contents().find("body").keypress(function(a){a.preventDefault()});l[0].focus();a.extend(!0,e,q);var s=b.find(".switchArea2").cleditor(e);b.find(".ps_drag").draggable({revert:"invalid",helper:"clone",appendTo:".switchEditor"});b.find(".ps_widget_content_div").droppable({accept:".ps_drag", drop:function(b,c){var d=c.draggable.find("img").data("src");a(this).find("img").attr("src",d)}});b.find(".ps_icon_trash").click(function(){a(this).parent().find("img").attr("src","")});b.find(".ps_ok").click(function(){b.find(".ps_widget_content_div img").each(function(b,c){d.find('[data-type="AdImage"] img').eq(b).attr("src",a(c).attr("src"))});d.find('[data-type="AdUrl"]').html(l.getHtml());d.find('[data-type="AdText"]').html(s.getHtml());k()});a(c).delegate('[data-type="AdArea"]',"click",function(){d= a(this);d.find('[data-type="AdImage"] img').each(function(c,d){b.find(".ps_widget_content_div img").eq(c).attr("src",a(d).attr("src"))});l.updateHtml(d.find('[data-type="AdUrl"]').html());s.updateHtml(d.find('[data-type="AdText"]').html());m(b,500,479)})}function A(c){var b=a("#PSEditor .bannerEditor");b.find(".ps_divGallery").append(a(n).addClass("ps_gallery ps_drag"));var f={width:315,height:90,controls:"outerlink"};a.extend(!0,f,q);var e=[];b.find("textarea").each(function(b){var c=a(this).cleditor(f); c.focus();c[0].$frame.contents().find("body").keypress(function(a){a.preventDefault()});e[b]=c});b.find(".ps_drag").draggable({revert:"invalid",helper:"clone",appendTo:".bannerEditor"});b.find(".ps_widget_content_div").droppable({accept:".ps_drag",drop:function(b,c){var d=c.draggable.find("img").data("src");a(this).find("img").attr("src",d)}});b.find(".ps_icon_trash").click(function(){a(this).parent().find("img").attr("src","")});b.find(".ps_ok").click(function(){b.find(".ps_divSwitch").each(function(b, c){d.find('[data-type="BannerImage"] img').eq(b).attr("src",a(c).find("img").attr("src"));d.find('[data-type="BannerUrl"]').eq(b).html(e[b].getHtml())});k()});a(c).delegate('[data-type="BannerArea"]',"click",function(){d=a(this);a.each(e,function(a,c){b.find(".ps_widget_content_div img").eq(a).attr("src",d.find('[data-type="BannerImage"] img').eq(a).attr("src"));c.updateHtml(d.find('[data-type="BannerUrl"]').eq(a).html())});m(b,500,642)})}var d,p=0;r=n=void 0;var q={colors:"FFF FCC FC9 FF9 FFC 9F9 9FF CFF CCF FCF CCC F66 F96 FF6 FF3 6F9 3FF 6FF 99F F9F BBB F00 F90 FC6 FF0 3F3 6CC 3CF 66C C6C 999 C00 F60 FC3 FC0 3C0 0CC 36F 63F C3C 666 900 C60 C93 990 090 399 33F 60C 939 333 600 930 963 660 060 366 009 339 636 000 300 630 633 330 030 033 006 309 303", fonts:"Arial,Arial Black,Comic Sans MS,Courier New,Narrow,Garamond,Georgia,Impact,Sans Serif,Serif,Tahoma,Trebuchet MS,Verdana",sizes:"1,2,3,4,5,6,7",styles:[["Paragraph","<p>"],["Header 1","<h1>"],["Header 2","<h2>"],["Header 3","<h3>"],["Header 4","<h4>"],["Header 5","<h5>"],["Header 6","<h6>"]],useCSS:!1,docType:"",docCSSFile:"",bodyStyle:"margin: 4px; font-family:\u5fae\u8edf\u6b63\u9ed1\u9ad4, Arial; cursor:text"};a.fn.PSEditor=function(c){var b=a.extend({getImgUrl:""},c);if(""==b.getImgUrl)throw"The option [getImgUrl] is required."; return this.each(function(){u(this,b.getImgUrl)})};String.format=function(){if(0==arguments.length)return null;for(var a=arguments[0],b=1;b<arguments.length;b++)a=a.replace(RegExp("\\{"+(b-1)+"\\}","gm"),arguments[b]);return a}})(jQuery);